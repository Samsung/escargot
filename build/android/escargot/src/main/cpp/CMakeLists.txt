cmake_minimum_required(VERSION 3.18.1)

project(escargot-jni)

option(UNDER_NDK "Build under the Android NDK" ON)

SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -fexceptions")

if (NOT UNDER_NDK)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -static-libstdc++")
endif ()

# SET (ESCARGOT_HOST "android")
SET (ESCARGOT_ARCH ${ANDROID_SYSROOT_ABI})
# STRING(TOLOWER ${CMAKE_BUILD_TYPE} ESCARGOT_MODE)
SET (ESCARGOT_MODE "release")
SET (ESCARGOT_THREADING ON)
ADD_SUBDIRECTORY (${CMAKE_CURRENT_SOURCE_DIR}/../../../../../../ escargot)

ADD_LIBRARY (escargot-jni SHARED escargot.cpp)

SET(LOG_LIBRARY "")
if (NOT UNDER_NDK)
    ADD_DEFINITIONS(-DNDEBUG)
endif ()


if (UNDER_NDK)
    FIND_LIBRARY(LOG_LIBRARY log)
else (UNDER_NDK)
    FIND_PACKAGE(JNI REQUIRED)
    INCLUDE_DIRECTORIES(${JNI_INCLUDE_DIRS})
endif ()

TARGET_LINK_LIBRARIES (escargot-jni PRIVATE escargot ${LOG_LIBRARY})